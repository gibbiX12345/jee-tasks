<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">

<h2 class="text-center mb-4">#{taskBean.currentlySelectedList != null ? taskBean.currentlySelectedList.title : 'All Tasks'}</h2>
<div class="list-description text-center mb-4"
     style="white-space: pre-wrap">#{taskBean.currentlySelectedList != null ? taskBean.currentlySelectedList.description : ''}</div>
<c:choose>
    <c:when test="#{taskBean.currentlySelectedList != null}">
        <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal"
                data-bs-target="#editTaskListModal">
            Edit List
        </button>
    </c:when>
</c:choose>
<div class="table-responsive">
    <h:dataTable value="#{taskBean.tasks}" var="task" styleClass="table table-striped table-bordered">
        <h:column>
            <f:facet name="header">Task ID</f:facet>
            <h:outputText value="#{task.taskId}"/>
        </h:column>
        <h:column>
            <f:facet name="header">Title</f:facet>
            <h:outputText value="#{task.title}"/>
        </h:column>
        <h:column>
            <f:facet name="header">Description</f:facet>
            <h:outputText value="#{task.description}"/>
        </h:column>
        <h:column>
            <f:facet name="header">Priority</f:facet>
            <h:outputText value="#{task.priority != null ? task.priority.level : '-'}"/>
        </h:column>
        <h:column>
            <f:facet name="header">Status</f:facet>
            <h:outputText value="#{task.status != null ? task.status.value : '-'}"/>
        </h:column>
        <h:column>
            <f:facet name="header">Due Date</f:facet>
            <h:outputText value="#{task.getFormattedDueDate()}"/>
        </h:column>
        <h:column>
            <f:facet name="header">Edit</f:facet>
            <h:form>
                <h:commandButton value="Edit" action="#{taskBean.prepareForEdit(task)}"
                                 class="btn btn-primary">
                    <f:ajax event="action" execute="@form" render="@all" onevent="openModal"/>
                </h:commandButton>
            </h:form>
        </h:column>
    </h:dataTable>
</div>
<c:choose>
    <c:when test="#{taskBean.currentlySelectedList != null}">
        <h:form>
            <h:commandButton value="Create New Task" action="#{taskBean.prepareForEdit(null)}"
                             class="btn btn-primary">
                <f:ajax event="action" execute="@form" render="@all" onevent="openModal"/>
            </h:commandButton>
        </h:form>
    </c:when>
</c:choose>
<ui:include src="forms/edit_task_list_modal.xhtml"/>
<ui:include src="forms/task_edit_mask.xhtml"/>


<script type="text/javascript">
    function openModal(data) {
        if (data.status === "success") {
            // Open the modal after the AJAX call is successful
            const modal = new bootstrap.Modal(document.getElementById('taskEditMaskModal'));
            modal.show();
        }
    }
</script>
</html>
